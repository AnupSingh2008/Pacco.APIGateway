name: Orders
path: /orders

routes:
- upstream: /
  method: GET
  use: downstream
  downstream: orders-service/orders?customerId=@user_id
  auth: true

- upstream: /{orderId}
  method: GET
  use: downstream
  downstream: orders-service/orders/{orderId}
  auth: true

- upstream: /
  method: POST
  use: downstream
  downstream: orders-service/orders
  auth: true
  resource_id:
    property: orderId
    generate: true
  bind:
    - customerId:@user_id

- upstream: /{orderId}
  method: DELETE
  use: downstream
  downstream: orders-service/orders/{orderId}
  auth: true
  
- upstream: /{orderId}/parcels/{parcelId}
  method: POST
  use: downstream
  downstream: orders-service/orders/{orderId}/parcels/{parcelId}
  auth: true
  bind:
    - customerId:@user_id
    - orderId:{orderId}
    - parcelId:{parcelId}
  
- upstream: /{orderId}/parcels/{parcelId}
  method: DELETE
  use: downstream
  downstream: orders-service/orders/{orderId}/parcels/{parcelId}
  auth: true

- upstream: /{orderId}/vehicles/{vehicleId}
  method: POST
  use: downstream
  downstream: orders-service/orders/{orderId}/vehicles/{vehicleId}
  auth: true
  bind:
    - orderId:{orderId}
    - vehicleId:{vehicleId}
    - customerId:@user_id
  
services:
  orders-service:
    local_url: localhost:5006
    url: load_balancer/orders-service
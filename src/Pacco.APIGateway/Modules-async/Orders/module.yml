name: Orders
path: /orders

routes:
- upstream: /
  method: GET
  use: downstream
  downstream: orders-service/orders?customerId=@user_id
  auth: true

- upstream: /{id}
  method: GET
  use: downstream
  downstream: orders-service/orders/{id}
  auth: true

- upstream: /
  method: POST
  auth: true
  use: dispatcher
  exchange: orders
  routing_key: orders.create_order
  bind:
    - customerId:@user_id

- upstream: /{id}
  method: DELETE
  auth: true
  use: dispatcher
  exchange: orders
  routing_key: orders.delete_order
  bind:
    - id:{id}
  
- upstream: /{orderId}/parcels
  method: POST
  auth: true
  use: dispatcher
  exchange: orders
  routing_key: orders.add_parcel_to_order
  bind:
    - orderId:{orderId}
  
- upstream: /{orderId}/parcels/{parcelId}
  method: DELETE
  auth: true
  use: dispatcher
  exchange: orders
  routing_key: orders.delete_parcel_from_order
  bind:
    - orderId:{orderId}
    - parcelId:{parcelId}
  
- upstream: /{orderId}/vehicles
  method: POST
  auth: true
  use: dispatcher
  exchange: orders
  routing_key: orders.assign_vehicle_to_order
  bind:
    - orderId:{orderId}
  
services:
  orders-service:
    url: localhost:5006
#    url: localhost:9999/orders-service
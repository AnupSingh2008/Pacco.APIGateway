name: Identity
path: /identity

routes:
  - upstream: /users/{userId}
    method: GET
    use: downstream
    downstream: identity-service/users/{userId}
    auth: true
    claims:
      role: admin

  - upstream: /me
    method: GET
    use: downstream
    downstream: identity-service/me
    auth: true

  - upstream: /sign-up
    method: POST
    auth: false
    resource_id:
      property: userId
      generate: true
    use: message_broker
    config:
      exchange: identity
      routing_key: identity.sign_up

  - upstream: /sign-in
    method: POST
    auth: false
    use: downstream
    downstream: identity-service/sign-in
    response_headers:
      content-type: application/json

services:
  identity-service:
    local_url: localhost:5004
    url: identity-service
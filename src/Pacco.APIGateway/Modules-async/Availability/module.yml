name: Availability
path: /availability

routes:
- upstream: /resources/{resourceId}
  method: GET
  use: downstream
  downstream: availability-service/resources/{resourceId}
  auth: true

- upstream: /resources
  method: POST
  auth: true
  use: message_broker
  config:
    exchange: availability
    routing_key: availability.add_resource

- upstream: /resources/{resourceId}/reservations/{dateTime}
  method: POST
  auth: true
  use: message_broker
  config:
    exchange: availability
    routing_key: availability.reserve_resource
  bind:
    - resourceId:{resourceId}
    - customerId:@user_id
    - dateTime:{dateTime}

- upstream: /resources/{resourceId}/reservations/{dateTime}
  method: DELETE
  auth: true
  use: message_broker
  config:
    exchange: availability
    routing_key: availability.release_resource
  bind:
    - resourceId:{resourceId}
    - dateTime:{dateTime}

- upstream: /resources/{resourceId}
  method: DELETE
  auth: true
  use: message_broker
  config:
    exchange: availability
    routing_key: availability.delete_resource
  bind:
    - resourceId:{resourceId}

services:
  availability-service:
    local_url: localhost:5001
    url: load_balancer/availability-service
name: Parcels
path: /parcels

routes:
- upstream: /
  method: GET
  use: downstream
  downstream: parcels-service/parcels?customerId=@user_id
  auth: true

- upstream: /{parcelId}
  method: GET
  use: downstream
  downstream: parcels-service/parcels/{parcelId}
  auth: true

- upstream: /volume
  method: GET
  use: downstream
  downstream: parcels-service/parcels/volume
  auth: true

- upstream: /
  method: POST
  auth: true
  resource_id:
    property: parcelId
    generate: true
  use: message_broker
  config:
    exchange: parcels
    routing_key: parcels.add_parcel
  bind:
    - customerId:@user_id

- upstream: /{parcelId}
  method: DELETE
  auth: true
  use: message_broker
  config:
    exchange: parcels
    routing_key: parcels.delete_parcel
  bind:
    - parcelId:{parcelId}
    - customerId:@user_id
  
services:
  parcels-service:
    local_url: localhost:5007
    url: parcels-service